<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>denoise.me &middot; distraction-free media viewing and sharing</title>
  <meta name="description" content="Clutter-free video sharing.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style type="text/css">
    body {
      text-align: center;
    }
    #videocontainer {
      margin: 42px auto;
      max-width: 1000px;
    }
    #videocontainer > div {
      position: relative;
      padding: 30px 0 56.25%;
      height: 0;
      overflow: hidden;
    }
    iframe, object, embed {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        margin: 0 auto;
    }
    footer, a, a:visited {
      font-family: sans-serif;
      color: #bbb;
    }
    small {
      display: block;
      margin: 0 0 5px;
    }
    @media(max-width: 568px) {
      #bookmarklet {
        display: none;
      }
    }
  </style>
</head>
<body>
  
  <div id="videocontainer">
    <div>
      <iframe id="iframe" src="" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
    </div>
  <div>
  <footer>
    <small>created by <a href="https://twitter.com/besublime">@BeSublime</a> | fork me on <a href="https://github.com/BeSublime/denoise.me">github</a></small>
    <small id="bookmarklet">have some extra room in your bookmarks bar? drag this up there for easy access: 
      <a href="javascript:(function()%7Bvar%20d=document,w=window,l=w.location,enc=encodeURIComponent,f='http://denoise.me/',p='?u='+enc(l.href),u=f+p;try%7Bthrow('Uh%20oh!%20Something%20broke.');%7Dcatch(z)%7Ba=function()%7Bif(!w.open(u))l.href=u;%7D;if(/Firefox/.test(navigator.userAgent))setTimeout(a,0);else%20a();%7Dvoid(0);%7D)()" class="bookmarklet" onclick="alert('Drag me to your toolbar first, then click me when you find a video you\'d like to denoise!');return false;">
        denoise.me
      </a>
    </small>
  </footer>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script>
    (function() {
      if (true) {
        var queryString = {},
            iframe = document.getElementById('iframe'),
            vimeoUrl = 'http://player.vimeo.com/video/',
            youtubeUrl = 'http://www.youtube.com/embed/',
            hash = '#',
            src, vid, host;  // don't knock my variable names, you're smart enough to figure out the difference

        // convert the query string to an object
        decodeURIComponent(window.location.search).replace(/([^?=&]+)(=([^&\?]*))?/g, function ($0, $1, $2, $3) {
          queryString[$1] = $3;
        });

        if (typeof queryString.u === 'undefined')
          queryString.u = 'http://vimeo.com/1084537';

        queryString.u.replace(/([a-z]+)\.com/g, function($0, $1, $2, $3) {
          host = $1;
        });

        if (!host) // host not found, set to default
          host = 'vimeo';

        var getVid = function(regex, index) {
          var id = queryString.u.match(regex);
          if (id && id.length > index - 1)
            return id[index];
          else
            return null;
        }

        switch(host) {
          case 'vimeo':
            src = vimeoUrl;
            if (!(vid = queryString.v))
              vid = getVid(/(\w+\/)([^video\/&#\?]+)/, 2);

            vid = vid || '1084537'; // TODO: still need this?
            break;
          case 'youtube':
            src = youtubeUrl;
            if (!(vid = queryString.v))
              vid = getVid(/(v=|embed\/)([^&#\?]+)/, 2);

            // reformat the time query string if present (from &t=XXmXXs to &start=XXs)
            if (typeof queryString.t !== 'undefined') {
              var time = queryString.t.match(/\d+|\w/g);
              var seconds = 0;
              for (var i=0; i<time.length; i++) { // TODO: only need to loop over the even indexes
                if (time[i+1] === 'm')
                  seconds += time[i] * 60;
                else if (time[i+1] === 's')
                  seconds += parseInt(time[i]);
              }
              if (seconds > 0)
                queryString.start = seconds;
            }

            vid = vid || 'YE7VzlLtp-4';
            break;
          default:
            // unsupported host
            break;
        }

        src = src + vid;

        // append additional query string and/or hash string parameters
        var i = 0;
        for (var p in queryString) {
          if (!p.match(/^[vut]$/)) {
            src = i == 0 ? src + "?" : src + "&";
            src = src + p + '=' + queryString[p];
            i++;
          }
        }

        if (hash.length > 1)
          src += hash;

        // PUSH the little red button (and you may want to put on a seat belt)
        iframe.src = src;
      }
    })();
  </script>
  <script>  
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-42883729-1']);
    _gaq.push(['_trackPageview']);
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
</body>
</html>
